{"ast":null,"code":"import axios from\"axios\";import{useFormik}from\"formik\";import React,{useContext}from\"react\";import{addCart}from\"../../Context/AddProductToCart\";import toast from\"react-hot-toast\";import{useNavigate}from\"react-router-dom\";import{Helmet}from\"react-helmet\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function Payment(){const{cartId,deleteCart}=useContext(addCart);const navigate=useNavigate();const initialValues={details:\"\",phone:\"\",city:\"\"};const validate=values=>{const errors={};const phoneRegex=/^01[0125][0-9]{8}$/;if(!phoneRegex.test(values.phone)){errors.phone=\"Must use Egyptian phone number format\";}if(values.details.length<12){errors.details=\"Must be more than 12 characters\";}return errors;};const confirmCashPayment=async values=>{try{const response=await axios.post(\"https://ecommerce.routemisr.com/api/v1/orders/\".concat(cartId),values,{headers:{token:localStorage.getItem(\"tkn\")}});toast.success(\"Your payment is successful\");deleteCart();setTimeout(()=>{navigate(\"/home\");},2000);}catch(error){console.error(\"Error:\",error);toast.error(\"Error processing payment. Please check your cart items.\");}};const confirmOnlinePayment=async values=>{try{const response=await axios.post(\"https://ecommerce.routemisr.com/api/v1/orders/checkout-session/\".concat(cartId),values,{headers:{token:localStorage.getItem(\"tkn\")},params:{url:\"http://localhost:3000\"}}).then(res=>{window.open(res.data.session.url,\"_self\");}).catch(()=>{});toast.success(\"To online payment\");}catch(error){console.error(\"Error:\",error);toast.error(\"Error processing payment. Please check your cart items.\");}};const formik=useFormik({initialValues,onSubmit:confirmCashPayment,validate});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Helmet,{children:/*#__PURE__*/_jsx(\"title\",{children:\"Payment\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"container my-2 bg-light\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Shipping Address:\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:formik.handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"details\",className:\"d-block\",children:\"Details:\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"details\",name:\"details\",cols:\"120\",rows:\"2\",className:\"form-control\",value:formik.values.details,onChange:formik.handleChange,onBlur:formik.handleBlur,placeholder:\"Details...\"}),formik.errors.details&&formik.touched.details&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",children:formik.errors.details})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"phone\",className:\"d-block\",children:\"Phone:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"phone\",type:\"text\",className:\"form-control\",name:\"phone\",placeholder:\"Phone...\",value:formik.values.phone,onChange:formik.handleChange,onBlur:formik.handleBlur}),formik.errors.phone&&formik.touched.phone&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",children:formik.errors.phone})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"city\",className:\"d-block\",children:\"City:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"city\",type:\"text\",className:\"form-control\",name:\"city\",placeholder:\"City...\",value:formik.values.city,onChange:formik.handleChange,onBlur:formik.handleBlur})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn bg-main my-3\",children:\"Confirm cash payment\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn bg-main my-3 mx-3\",onClick:()=>confirmOnlinePayment(formik.values),children:\"Confirm online payment\"})]})]})]});}","map":{"version":3,"names":["axios","useFormik","React","useContext","addCart","toast","useNavigate","Helmet","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Payment","cartId","deleteCart","navigate","initialValues","details","phone","city","validate","values","errors","phoneRegex","test","length","confirmCashPayment","response","post","concat","headers","token","localStorage","getItem","success","setTimeout","error","console","confirmOnlinePayment","params","url","then","res","window","open","data","session","catch","formik","onSubmit","children","className","handleSubmit","htmlFor","id","name","cols","rows","value","onChange","handleChange","onBlur","handleBlur","placeholder","touched","type","onClick"],"sources":["C:/Users/Mostafa/OneDrive/Desktop/Route/final-pro/src/component/PayMent/Payment.jsx"],"sourcesContent":["import axios from \"axios\";\r\nimport { useFormik } from \"formik\";\r\nimport React, { useContext } from \"react\";\r\nimport { addCart } from \"../../Context/AddProductToCart\";\r\nimport toast from \"react-hot-toast\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Helmet } from \"react-helmet\";\r\n\r\nexport default function Payment() {\r\n  const { cartId, deleteCart } = useContext(addCart);\r\n  const navigate = useNavigate();\r\n\r\n  const initialValues = {\r\n    details: \"\",\r\n    phone: \"\",\r\n    city: \"\",\r\n  };\r\n\r\n  const validate = (values) => {\r\n    const errors = {};\r\n    const phoneRegex = /^01[0125][0-9]{8}$/;\r\n    if (!phoneRegex.test(values.phone)) {\r\n      errors.phone = \"Must use Egyptian phone number format\";\r\n    }\r\n    if (values.details.length < 12) {\r\n      errors.details = \"Must be more than 12 characters\";\r\n    }\r\n    return errors;\r\n  };\r\n\r\n  const confirmCashPayment = async (values) => {\r\n    try {\r\n      const response = await axios.post(\r\n        `https://ecommerce.routemisr.com/api/v1/orders/${cartId}`,\r\n        values,\r\n        { headers: { token: localStorage.getItem(\"tkn\") } }\r\n      );\r\n\r\n      toast.success(\"Your payment is successful\");\r\n\r\n      deleteCart();\r\n      setTimeout(() => {\r\n        navigate(\"/home\");\r\n      }, 2000);\r\n    } catch (error) {\r\n      console.error(\"Error:\", error);\r\n      toast.error(\"Error processing payment. Please check your cart items.\");\r\n    }\r\n  };\r\n\r\n  const confirmOnlinePayment = async (values) => {\r\n    try {\r\n      const response = await axios.post(\r\n        `https://ecommerce.routemisr.com/api/v1/orders/checkout-session/${cartId}`,\r\n        values,\r\n        {\r\n          headers: {\r\n            token: localStorage.getItem(\"tkn\"),\r\n          },\r\n          params: {\r\n            url: \"http://localhost:3000\",\r\n          },\r\n        }\r\n      ).then((res)=>{\r\n       window.open( res.data.session.url,\"_self\")\r\n      })\r\n      .catch(()=>{\r\n\r\n      })\r\n\r\n      toast.success(\"To online payment\");\r\n    } catch (error) {\r\n      console.error(\"Error:\", error);\r\n      toast.error(\"Error processing payment. Please check your cart items.\");\r\n    }\r\n  };\r\n\r\n  const formik = useFormik({\r\n    initialValues,\r\n    onSubmit: confirmCashPayment,\r\n    validate,\r\n  });\r\n\r\n  return (\r\n    <>\r\n          <Helmet>\r\n        <title>Payment</title>\r\n      </Helmet>\r\n    <div className=\"container my-2 bg-light\">\r\n      <h2>Shipping Address:</h2>\r\n      <form onSubmit={formik.handleSubmit}>\r\n        <div className=\"mb-2\">\r\n          <label htmlFor=\"details\" className=\"d-block\">\r\n            Details:\r\n          </label>\r\n          <textarea\r\n            id=\"details\"\r\n            name=\"details\"\r\n            cols=\"120\"\r\n            rows=\"2\"\r\n            className=\"form-control\"\r\n            value={formik.values.details}\r\n            onChange={formik.handleChange}\r\n            onBlur={formik.handleBlur}\r\n            placeholder=\"Details...\"\r\n          />\r\n          {formik.errors.details && formik.touched.details && (\r\n            <div className=\"alert alert-danger\">{formik.errors.details}</div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"mb-2\">\r\n          <label htmlFor=\"phone\" className=\"d-block\">\r\n            Phone:\r\n          </label>\r\n          <input\r\n            id=\"phone\"\r\n            type=\"text\"\r\n            className=\"form-control\"\r\n            name=\"phone\"\r\n            placeholder=\"Phone...\"\r\n            value={formik.values.phone}\r\n            onChange={formik.handleChange}\r\n            onBlur={formik.handleBlur}\r\n          />\r\n          {formik.errors.phone && formik.touched.phone && (\r\n            <div className=\"alert alert-danger\">{formik.errors.phone}</div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"mb-2\">\r\n          <label htmlFor=\"city\" className=\"d-block\">\r\n            City:\r\n          </label>\r\n          <input\r\n            id=\"city\"\r\n            type=\"text\"\r\n            className=\"form-control\"\r\n            name=\"city\"\r\n            placeholder=\"City...\"\r\n            value={formik.values.city}\r\n            onChange={formik.handleChange}\r\n            onBlur={formik.handleBlur}\r\n          />\r\n        </div>\r\n\r\n        <button type=\"submit\" className=\"btn bg-main my-3\">\r\n          Confirm cash payment\r\n        </button>\r\n        <button\r\n          type=\"button\"\r\n          className=\"btn bg-main my-3 mx-3\"\r\n          onClick={() => confirmOnlinePayment(formik.values)}\r\n        >\r\n          Confirm online payment\r\n        </button>\r\n      </form>\r\n    </div></>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}